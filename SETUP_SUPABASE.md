# FoodieQuest Supabase Setup Guide

This guide describes how to set up the Supabase backend for the FoodieQuest application.

## 1. Create a Supabase Project

1. Go to [database.new](https://database.new) and create a new project.
2. Note down your `Project URL` and `Anon Key` from **Settings > API**.

## 2. Database Schema

Run the following SQL in the **SQL Editor** of your Supabase dashboard to create the tables.

```sql
-- Create Recipes Table
CREATE TABLE recipes (
    id BIGINT GENERATED BY DEFAULT AS IDENTITY PRIMARY KEY,
    created_at TIMESTAMPTZ DEFAULT NOW(),
    title TEXT NOT NULL,
    description TEXT,
    ingredients TEXT NOT NULL, -- Storing as simple text for simplicity, or JSONB if preferred
    instructions TEXT NOT NULL,
    image_url TEXT,
    rating NUMERIC DEFAULT 0
);

-- Enable RLS for recipes (Optional, but good practice. For now, allow read/write for all)
ALTER TABLE recipes ENABLE ROW LEVEL SECURITY;
CREATE POLICY "Public recipes are viewable by everyone" ON recipes FOR SELECT USING (true);
-- Allow anon inserts if you entered recipes manually or want to allow it
-- CREATE POLICY "Anon can insert recipes" ON recipes FOR INSERT WITH CHECK (true);


-- Create Food Photos Table (User Uploads)
CREATE TABLE food_photos (
    id BIGINT GENERATED BY DEFAULT AS IDENTITY PRIMARY KEY,
    created_at TIMESTAMPTZ DEFAULT NOW(),
    image_url TEXT NOT NULL,
    caption TEXT,
    uploaded_by TEXT DEFAULT 'Anonymous' -- Simplified user ID
);

-- Enable RLS and Allow Anonymous Uploads (Inserts)
ALTER TABLE food_photos ENABLE ROW LEVEL SECURITY;
CREATE POLICY "Public photos are viewable by everyone" ON food_photos FOR SELECT USING (true);
CREATE POLICY "Anyone can upload photos" ON food_photos FOR INSERT WITH CHECK (true);


-- Create Favorites Table
CREATE TABLE favorites (
    id BIGINT GENERATED BY DEFAULT AS IDENTITY PRIMARY KEY,
    created_at TIMESTAMPTZ DEFAULT NOW(),
    recipe_id BIGINT REFERENCES recipes(id) ON DELETE CASCADE
    -- Add user_id here if implementing auth
);

-- Insert some sample data
INSERT INTO recipes (title, description, ingredients, instructions, image_url, rating)
VALUES
('Nasi Goreng Spesial', 'Indonesian fried rice with a twist.', 'Rice, Egg, Sweet Soy Sauce, Garlic, Chili', '1. Fry garlic.\n2. Add egg.\n3. Add rice and sauces.\n4. Serve hot.', 'https://images.unsplash.com/photo-1512058564366-18510be2db19?auto=format&fit=crop&w=800&q=80', 4.8),
('Spaghetti Carbonara', 'Classic Italian pasta.', 'Spaghetti, Eggs, Pecorino Cheese, Guanciale, Black Pepper', '1. Boil pasta.\n2. Fry guanciale.\n3. Mix eggs and cheese.\n4. Combine all off heat.', 'https://images.unsplash.com/photo-1612874742237-6526221588e3?auto=format&fit=crop&w=800&q=80', 4.5),
('Avocado Toast', 'Simple and healthy breakfast.', 'Bread, Avocado, Salt, Pepper, Lemon Juice', '1. Toast bread.\n2. Mash avocado.\n3. Spread on toast.\n4. Season.', 'https://images.unsplash.com/photo-1541519227354-08fa5d50c44d?auto=format&fit=crop&w=800&q=80', 4.2);
```

## 3. Storage Setup (CRITICAL FOR UPLOADS)

1. Go to **Storage**.
2. Create a new bucket named `food-photos`.
3. Set the bucket to **Public**.
4. **Fix "Unauthorized" Errors**: You must run the following SQL to allow uploads to this bucket.

```sql
-- Allow public access to the bucket's objects
CREATE POLICY "Public Access"
ON storage.objects FOR SELECT
USING ( bucket_id = 'food-photos' );

-- Allow anonymous uploads
CREATE POLICY "Allow Uploads"
ON storage.objects FOR INSERT
WITH CHECK ( bucket_id = 'food-photos' );
```

**Alternatively**, use the UI:

1. Go to **Configuration > Policies**.
2. Under `food-photos`, click **New Policy**.
3. Select **"For full customization"**.
4. Allowed operations: `INSERT`, `SELECT`.
5. Target roles: `anon`, `authenticated` (or just check "All").
6. Click **Save**.

## 4. Environment Variables

In your Flutter project, you will need to add your Supabase credentials. Ideally use a `.env` file, but for this simple project, you may replace the placeholders in `lib/services/supabase_service.dart`.

```dart
const String supabaseUrl = 'YOUR_SUPABASE_URL';
const String supabaseAnonKey = 'YOUR_SUPABASE_ANON_KEY';
```
